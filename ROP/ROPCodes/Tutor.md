# 汇编器语法

## 1. org  
开启一个新的代码段并设置起始地址。本段中所有的地址（标签计算）以这个地址开始。也可以使用标签定义地址。  
```
org 0x3a3b ; 这一段的起始地址为3a3b
hex .. ..
label: ; 标签位置在3a3c
org 0x4a4b ; 这一段的起始地址为4a4b
org &label +2 ; 这一段的起始位置为3a3e
org & +10 ; 这一段的起始位置为3a4e
;注意，&后要加上空格
```
org后跟大括号代表插入代码段，大括号结束时回到之前的段。    
```
org 0xd522
hex .. .. ; 这里是d524
org & -8 { ; 这一段的起始位置为d51c（注意要加空格)
    hex .. .. .. ..
}
; 这里又回到了d524
```
如果两段重合，编译器会合并代码，一旦出现冲突就会报错。
## 2. hex  
```
hex 3. .. 30 43
```
直接写16进制，内容会直接原封不动视为一串16进制。.代表可以取任何值（由编译器决定）。hex可以省略。  

## 3. 标签/取地址  

```
#org d522
hex 33 33 
loop:   ;<--此时，标签代表的地址是(0xd522+2=0xd524)
hex .. .. .. ..
adr loop ; <-- 'adr loop' 会被替换成：hex 24 d5 (d524, loop的地址)
adr loop 55 ; <- 0xd524+55
adr loop -2 ; <- 0xd522
adr +2 ; <-- 不写标签名，则表示从当前地址(d52e)起算，替换成d530

```

## 4. 函数标签  
所有可用标签请查看sym.txt  
注意，所有标签使用需要单独成行
```
例子：sym.txt 115 行：
20840       and r1, 15, sll r0, 4, or r1, r0
当你在汇编中，使用
and r1, 15, sll r0, 4, or r1, r0
会被替换为 hex 40 08 .2 ..
```

```
例子2：sym.txt 115 行：
@0F746       read_key
当你在汇编中，使用
read_key
会被替换为 hex 48 f7 .2 ..(注意,当地址前面带'@',汇编器会自动将地址+2)
```

用def来定义标签，如`def @22040 diag`。

带参数个数的函数标签：在地址后面跟括号，里面写调用这个标签时pop的字节数。pop pc不算在内。例如pop qr0的标签可以写作`def 130e2(8) pop qr0`。在程序中调用这类函数标签，后面必须跟括号，里面是相应数目的字节。例如`pop qr0 (31 32 .. .. .. .6 7. fe)`。

## 5.使用asm.py
Windows:
```
python3.exe .\asm.py xxx (你想编译的文件）
python3.exe .\asm.py xxx (你想编译的文件）-min  ;原封不动输出 hex中的 ..  而不是自动替换

```
Linux:
```
python3 ./asm.py xxx (你想编译的文件）
python3 ./asm.py xxx (你想编译的文件）-min  ;原封不动输出 hex中的 ..  而不是自动替换

```
